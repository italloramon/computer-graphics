(()=>{"use strict";var e,t={7888:(e,t,n)=>{n.d(t,{A:()=>o});const o="uniform sampler2D mirrorSampler;\nuniform float alpha;\nuniform float time;\nuniform float size;\nuniform float distortionScale;\nuniform sampler2D normalSampler;\nuniform vec3 sunColor;\nuniform vec3 sunDirection;\nuniform vec3 eye;\nuniform vec3 waterColor;\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\nuniform float speed;\n\nvec4 getNoise(vec2 uv) {\n    float offset;\n    if (speed == 0.0){\n        offset = time / 10.0;\n    }\n    else {\n        offset = speed;\n    }\n    vec2 uv3 = uv / vec2(50.0, 50.0) - vec2(speed / 1000.0, offset);\n    vec2 uv0 = vec2(0, 0);\n    vec2 uv1 = vec2(0, 0);\n    vec2 uv2 = vec2(0, 0);\n    vec4 noise = texture2D(normalSampler, uv0) +\n    texture2D(normalSampler, uv1) +\n    texture2D(normalSampler, uv2) +\n    texture2D(normalSampler, uv3);\n    return noise * 0.5 - 1.0;\n}\nvoid sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor) {\n    vec3 reflection = normalize(reflect(-sunDirection, surfaceNormal));\n    float direction = max(0.0, dot(eyeDirection, reflection));\n    specularColor += pow(direction, shiny) * sunColor * spec;\n    diffuseColor += max(dot(sunDirection, surfaceNormal), 0.0) * sunColor * diffuse;\n}\n    #include <common>\n    #include <packing>\n    #include <bsdfs>\n    #include <fog_pars_fragment>\n    #include <logdepthbuf_pars_fragment>\n    #include <lights_pars_begin>\n    #include <shadowmap_pars_fragment>\n    #include <shadowmask_pars_fragment>\nvoid main() {\n    #include <logdepthbuf_fragment>\n    vec4 noise = getNoise(worldPosition.xz * size);\n    vec3 surfaceNormal = normalize(noise.xzy * vec3(1.5, 1.0, 1.5));\n    vec3 diffuseLight = vec3(0.0);\n    vec3 specularLight = vec3(0.0);\n    vec3 worldToEye = eye-worldPosition.xyz;\n    vec3 eyeDirection = normalize(worldToEye);\n    sunLight(surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight);\n    float distance = length(worldToEye);\n    vec2 distortion = surfaceNormal.xz * (0.001 + 1.0 / distance) * distortionScale;\n    vec3 reflectionSample = vec3(texture2D(mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion));\n    float theta = max(dot(eyeDirection, surfaceNormal), 0.0);\n    float rf0 = 0.3;\n    float reflectance = rf0 + (1.0 - rf0) * pow((1.0 - theta), 5.0);\n    vec3 scatter = max(0.0, dot(surfaceNormal, eyeDirection)) * waterColor;\n    vec3 albedo = mix((sunColor * diffuseLight * 0.3 + scatter) * getShadowMask(), (vec3(0.1) + reflectionSample * 0.9 + reflectionSample * specularLight), reflectance);\n    vec3 outgoingLight = albedo;\n    gl_FragColor = vec4(outgoingLight, alpha);\n    #include <tonemapping_fragment>\n    #include <fog_fragment>\n}\n"},5726:(e,t,n)=>{n.d(t,{A:()=>o});const o="uniform mat4 textureMatrix;\nuniform float time;\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\nvarying float speed;\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n    mirrorCoord = modelMatrix * vec4( position, 1.0 );\n    worldPosition = mirrorCoord.xyzw;\n    mirrorCoord = textureMatrix * mirrorCoord;\n    vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n    #include <beginnormal_vertex>\n    #include <defaultnormal_vertex>\n    #include <logdepthbuf_vertex>\n    #include <fog_vertex>\n    #include <shadowmap_vertex>\n}\n"},8575:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sceneSetup=t.endLevel=t.sceneConfiguration=t.destructionBits=t.camera=t.scene=void 0;const o=n(5824),i=n(3993),r=n(8509),a=n(464),s=n(3276),l=n(5249),c=n(9264),d=n(5968),u=n(5640),m=n(4229);let p;t.scene=new o.Scene,t.camera=new o.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3),t.destructionBits=new Array;let g,f=0,v=0;const h=new o.PlaneGeometry(1e4,1e4),y=new i.Water(h,{textureWidth:512,textureHeight:512,waterNormals:(new o.TextureLoader).load("static/normals/waternormals.jpeg",(function(e){e.wrapS=e.wrapT=o.MirroredRepeatWrapping})),sunDirection:new o.Vector3,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==t.scene.fog});let w=!1,x=!1;const C=new o.Vector3,M=new o.HemisphereLight(16777215,4473924,1);M.position.set(0,1,0),t.scene.add(M),t.sceneConfiguration={ready:!1,cameraMovingToStartPosition:!1,rocketMoving:!1,data:{crystalsCollected:0,shieldsCollected:0},courseLength:500,courseProgress:0,levelOver:!1,level:1,coursePercentComplete:()=>t.sceneConfiguration.courseProgress/t.sceneConfiguration.courseLength,cameraStartAnimationPlaying:!1,backgroundBitCount:0,challengeRowCount:0,speed:0},window.addEventListener("resize",(function(){t.camera.aspect=window.innerWidth/window.innerHeight,t.camera.updateProjectionMatrix(),p.setSize(window.innerWidth,window.innerHeight),L()}),!1);const k=()=>{var e,n,o,i,r,a,u,g;if(requestAnimationFrame(k),w&&(d.rocketModel.position.x-=.5),x&&(d.rocketModel.position.x+=.5),d.rocketModel.position.x+=v,d.rocketModel.position.x=(g=d.rocketModel.position.x,-20,25,Math.min(Math.max(g,-20),25)),t.sceneConfiguration.rocketMoving&&(c.progressUiElement.style.width=String(200*t.sceneConfiguration.coursePercentComplete())+"px",t.sceneConfiguration.speed+=.001,t.sceneConfiguration.courseProgress+=t.sceneConfiguration.speed,(0,s.garbageCollector)()),t.sceneConfiguration.ready){if(null!=(null===(e=d.rocketModel.userData)||void 0===e?void 0:e.mixer)&&(null===(o=null===(n=d.rocketModel.userData)||void 0===n?void 0:n.mixer)||void 0===o||o.update(d.rocketModel.userData.clock.getDelta())),t.sceneConfiguration.cameraStartAnimationPlaying||(t.camera.position.x=20*Math.cos(f),t.camera.position.z=20*Math.sin(f),t.camera.position.y=30,t.camera.lookAt(d.rocketModel.position),f+=.005),t.sceneConfiguration.levelOver&&t.sceneConfiguration.speed>0&&(t.sceneConfiguration.speed-=.1),t.destructionBits.forEach((e=>{e.userData.clock&&e.userData.mixer&&e.userData.mixer.update(e.userData.clock.getDelta())})),null===(r=null===(i=t.camera.userData)||void 0===i?void 0:i.mixer)||void 0===r||r.update(null===(u=null===(a=t.camera.userData)||void 0===a?void 0:a.clock)||void 0===u?void 0:u.getDelta()),t.sceneConfiguration.rocketMoving){(0,m.detectCollisions)();for(let e=0;e<d.environmentBits.length;e++)d.environmentBits[e].position.z+=t.sceneConfiguration.speed;for(let e=0;e<d.challengeRows.length;e++)d.challengeRows[e].rowParent.position.z+=t.sceneConfiguration.speed;d.environmentBits.length&&!(d.environmentBits[0].position.z>-1300)||t.sceneConfiguration.levelOver||(0,d.addBackgroundBit)(t.sceneConfiguration.backgroundBitCount++,!0),d.challengeRows.length&&!(d.challengeRows[0].rowParent.position.z>-1300)||t.sceneConfiguration.levelOver||(0,d.addChallengeRow)(t.sceneConfiguration.challengeRowCount++,!0),null!=d.starterBay&&(d.starterBay.position.z+=t.sceneConfiguration.speed),d.starterBay.position.z>200&&t.scene.remove(d.starterBay)}(0,l.moveCollectedBits)(),t.sceneConfiguration.courseProgress>=t.sceneConfiguration.courseLength&&(d.rocketModel.userData.flyingAway||(0,t.endLevel)(!1)),d.rocketModel.userData.flyingAway&&t.camera.lookAt(d.rocketModel.position)}L(),p.render(t.scene,t.camera)};function L(){y.material.uniforms.time.value+=1/60,t.sceneConfiguration.rocketMoving&&(y.material.uniforms.speed.value+=t.sceneConfiguration.speed/50)}function B(e){console.log("keypress");let t=e.which;37==t?w=!0:39==t&&(x=!0)}function S(e){let t=e.which;37==t?w=!1:39==t&&(x=!1)}t.endLevel=e=>{(0,c.updateLevelEndUI)(e),t.sceneConfiguration.rocketMoving=!1,t.sceneConfiguration.levelOver=!0,d.rocketModel.userData.flyingAway=!0,t.destructionBits.forEach((e=>{t.scene.remove(e)})),t.destructionBits.length=0,t.camera.position;let n=new o.Group,i=d.rocketModel.position.clone();n.position.copy(i),n.lookAt(d.rocketModel.position);let r=n.quaternion,a=new o.QuaternionKeyframeTrack(".quaternion",[0,2],[t.camera.quaternion.x,t.camera.quaternion.y,t.camera.quaternion.z,t.camera.quaternion.w,r.x,r.y,r.z,r.w]);const s=new o.AnimationClip("lookAtRocket",2,[a]),l=t.camera.userData.mixer.clipAction(s);l.setLoop(o.LoopOnce,1),l.clampWhenFinished=!0,l.play(),d.rocketModel.userData.mixer=new o.AnimationMixer(d.rocketModel);let u=new o.VectorKeyframeTrack(".position",[2,3,5],[d.rocketModel.position.x,d.rocketModel.position.y,d.rocketModel.position.z,20,100,20,40,400,100]),m=(new o.Quaternion).setFromEuler(new o.Euler(-90,0,-90)),p=new o.QuaternionKeyframeTrack(".quaternion",[0,2],[d.rocketModel.quaternion.x,d.rocketModel.quaternion.y,d.rocketModel.quaternion.z,d.rocketModel.quaternion.w,m.x,m.y,m.z,m.w]);d.rocketModel.userData.clock=new o.Clock;const g=new o.AnimationClip("flyAway",6,[u,p]),f=d.rocketModel.userData.mixer.clipAction(g);f.setLoop(o.LoopOnce,1),f.clampWhenFinished=!0,d.rocketModel.userData.mixer.addEventListener("finished",(function(){(0,c.showLevelEndScreen)()})),f.play()},t.sceneSetup=e=>{t.sceneConfiguration.challengeRowCount=0,t.sceneConfiguration.backgroundBitCount=0,t.camera.position.z=50,t.camera.position.y=12,t.camera.position.x=15,t.camera.rotation.y=2.5,t.scene.add(d.starterBay),d.starterBay.position.copy(new o.Vector3(10,0,120)),d.rocketModel.rotation.x=Math.PI,d.rocketModel.rotation.z=Math.PI,d.rocketModel.position.z=70,d.rocketModel.position.y=10,d.rocketModel.position.x=0,d.challengeRows.forEach((e=>{t.scene.remove(e.rowParent)})),d.environmentBits.forEach((e=>{t.scene.remove(e)})),d.environmentBits.length=0,d.challengeRows.length=0;for(let e=0;e<60;e++)(0,d.addChallengeRow)(t.sceneConfiguration.challengeRowCount++),(0,d.addBackgroundBit)(t.sceneConfiguration.backgroundBitCount++);t.sceneConfiguration.cameraStartAnimationPlaying=!1,t.sceneConfiguration.levelOver=!1,d.rocketModel.userData.flyingAway=!1,t.sceneConfiguration.courseProgress=0,t.sceneConfiguration.courseLength=1e3*e,t.sceneConfiguration.data.shieldsCollected=0,t.sceneConfiguration.data.crystalsCollected=0,c.crystalUiElement.innerText=String(t.sceneConfiguration.data.crystalsCollected),c.shieldUiElement.innerText=String(t.sceneConfiguration.data.shieldsCollected),document.getElementById("levelIndicator").innerText=`LEVEL ${t.sceneConfiguration.level}`,t.sceneConfiguration.ready=!0},(0,d.objectsInit)().then((e=>{(0,c.uiInit)(),async function(){var e,n,i;p=new o.WebGLRenderer,p.toneMapping=o.ACESFilmicToneMapping,p.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(p.domElement),(0,u.isTouchDevice)()&&null!=document.getElementById("joystick-zone")&&(g=a.create({zone:document.getElementById("joystick-zone")}),g.on("move",((e,t)=>{v=t.vector.x})),g.on("end",((e,t)=>{v=0}))),c.startPanel.classList.remove("hidden"),c.nextLevelButton.onclick=e=>{(0,c.nextLevel)()},c.startGameButton.onclick=e=>{t.sceneConfiguration.cameraStartAnimationPlaying=!0,c.shieldUiElement.classList.remove("danger"),document.getElementById("headsUpDisplay").classList.remove("hidden"),t.camera.userData.mixer=new o.AnimationMixer(t.camera);let n=new o.VectorKeyframeTrack(".position",[0,2],[t.camera.position.x,t.camera.position.y,t.camera.position.z,0,30,100],o.InterpolateSmooth),i=(new o.Quaternion).setFromAxisAngle(new o.Vector3(-1,0,0),.3),r=new o.QuaternionKeyframeTrack(".quaternion",[0,2],[t.camera.quaternion.x,t.camera.quaternion.y,t.camera.quaternion.z,t.camera.quaternion.w,i.x,i.y,i.z,i.w]);const a=new o.AnimationClip("animateIn",4,[n,r]),s=t.camera.userData.mixer.clipAction(a);s.setLoop(o.LoopOnce,1),s.clampWhenFinished=!0,t.camera.userData.clock=new o.Clock,t.camera.userData.mixer.addEventListener("finished",(function(){t.camera.lookAt(new o.Vector3(0,-500,-1400)),t.sceneConfiguration.rocketMoving=!0})),t.camera.userData.mixer.clipAction(a).play(),c.startPanel.classList.add("hidden")},document.addEventListener("keydown",B,!1),document.addEventListener("keyup",S,!1),(0,c.setProgress)("Scene loaded!"),null===(e=document.getElementById("loadingCover"))||void 0===e||e.remove(),null===(n=document.getElementById("loadingTextContainer"))||void 0===n||n.remove(),null===(i=document.getElementById("rocketPicture"))||void 0===i||i.remove(),y.rotation.x=-Math.PI/2,y.rotation.z=0,t.scene.add(y);const s=new r.Sky;s.scale.setScalar(1e4),t.scene.add(s);const l=s.material.uniforms;l.turbidity.value=10,l.rayleigh.value=2,l.mieCoefficient.value=.005,l.mieDirectionalG.value=.8;const m=new o.PMREMGenerator(p),f=o.MathUtils.degToRad(87),h=o.MathUtils.degToRad(115);C.setFromSphericalCoords(1,f,h),s.material.uniforms.sunPosition.value.copy(C),y.material.uniforms.sunDirection.value.copy(C).normalize(),t.scene.environment=m.fromScene(s).texture,y.material.uniforms.speed.value=0;const w=new o.SpotLight;w.lookAt(d.rocketModel.position),w.position.z=50,w.position.y=100,w.position.x=100,w.castShadow=!0,t.scene.add(w),d.rocketModel.scale.set(.3,.3,.3),t.scene.add(d.rocketModel),t.scene.add(d.mothershipModel),d.mothershipModel.position.y=200,d.mothershipModel.position.z=100,d.mothershipModel.scale.set(15,15,15),t.sceneConfiguration.ready=!0,(0,t.sceneSetup)(t.sceneConfiguration.level)}(),k()}))},4229:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.detectCollisions=void 0;const o=n(5824),i=n(5968),r=n(9264),a=n(710),s=n(8575);t.detectCollisions=()=>{if(s.sceneConfiguration.levelOver)return;const e=(new o.Box3).setFromObject(i.rocketModel);i.challengeRows.forEach((t=>{t.rowParent.updateMatrixWorld(),t.rowParent.children.forEach((t=>{t.children.forEach((n=>{const a=(new o.Box3).setFromObject(n);if(a.intersectsBox(e)){let e=a.getCenter(n.position);if(l(e),t.remove(n),void 0!==t.userData.objectType)switch(t.userData.objectType){case i.ObjectType.ROCK:s.sceneConfiguration.data.shieldsCollected--,r.shieldUiElement.innerText=String(s.sceneConfiguration.data.shieldsCollected),s.sceneConfiguration.data.shieldsCollected<=0?r.shieldUiElement.classList.contains("danger")||r.shieldUiElement.classList.add("danger"):r.shieldUiElement.classList.remove("danger"),s.sceneConfiguration.data.shieldsCollected<=-5&&(0,s.endLevel)(!0);break;case i.ObjectType.CRYSTAL:r.crystalUiElement.innerText=String(++s.sceneConfiguration.data.crystalsCollected);break;case i.ObjectType.SHIELD_ITEM:r.shieldUiElement.innerText=String(++s.sceneConfiguration.data.shieldsCollected)}}}))}))}))};const l=e=>{for(let t=0;t<6;t++){let n=new o.Mesh(new o.BoxGeometry(1,1,1),new o.MeshBasicMaterial({color:"black",transparent:!0,opacity:.4}));n.userData.lifetime=0,n.position.set(e.x,e.y,e.z),n.userData.mixer=new o.AnimationMixer(n);let r=t/45,l=15*Math.cos((0,a.radToDeg)(r)),c=15*Math.sin((0,a.radToDeg)(r)),d=new o.VectorKeyframeTrack(".position",[0,.3],[i.rocketModel.position.x,i.rocketModel.position.y,i.rocketModel.position.z,i.rocketModel.position.x+l,i.rocketModel.position.y,i.rocketModel.position.z+c]);const u=new o.AnimationClip("animateIn",10,[d]),m=n.userData.mixer.clipAction(u);m.setLoop(o.LoopOnce,1),m.clampWhenFinished=!0,m.play(),n.userData.clock=new o.Clock,s.scene.add(n),s.destructionBits.push(n)}}},3276:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.garbageCollector=void 0;const o=n(8575),i=n(5968);t.garbageCollector=()=>{let e=i.environmentBits.filter((e=>e.position.z>100)),t=i.challengeRows.filter((e=>e.rowParent.position.z>100));for(let t=0;t<e.length-1;t++){let n=i.environmentBits.indexOf(e[t]);o.scene.remove(i.environmentBits[n]),i.environmentBits.splice(n,1),console.log(`Removing environment object at index ${t} from scene`)}for(let e=0;e<t.length-1;e++){let n=i.challengeRows.indexOf(t[e]);o.scene.remove(t[e].rowParent),console.log(`Removing challenge line at index ${e} from scene`),i.challengeRows.splice(n,1)}}},5968:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectType=t.addChallengeRow=t.addBackgroundBit=t.objectsInit=t.shieldModel=t.rockModel=t.crystalModel=t.cliffsModel=t.mothershipModel=t.starterBay=t.rocketModel=t.challengeRows=t.environmentBits=void 0;const o=n(5824),i=n(8575),r=n(5507),a=n(9264);t.environmentBits=new Array,t.challengeRows=new Array;const s=new r.GLTFLoader;t.objectsInit=async()=>{t.cliffsModel=(await s.loadAsync("static/models/cliffs/scene.gltf")).scene.children[0],(0,a.setProgress)("Loading energy crystal model..."),t.crystalModel=(await s.loadAsync("static/models/glowing_crystals/scene.gltf")).scene.children[0],(0,a.setProgress)("Loading rock model..."),t.rockModel=(await s.loadAsync("static/models/glowing_rock/scene.gltf")).scene.children[0],(0,a.setProgress)("Loading shield model..."),t.shieldModel=(await s.loadAsync("static/models/shield_item/scene.gltf")).scene.children[0],(0,a.setProgress)("Loading rocket model ..."),t.rocketModel=(await s.loadAsync("static/models/rocket/scene.gltf")).scene.children[0],(0,a.setProgress)("Loading starter bay..."),t.starterBay=(await s.loadAsync("static/models/start_bay/scene.gltf")).scene,(0,a.setProgress)("Loading mothership..."),t.mothershipModel=(await s.loadAsync("static/models/spaceship_nortend/scene.gltf")).scene},t.addBackgroundBit=(e,n=!1)=>{let r=n?-1400:-60*e,a=t.cliffsModel.clone();a.scale.set(.02,.02,.02),a.position.set(e%2==0?60-Math.random():-60-Math.random(),0,r),a.rotation.set(o.MathUtils.degToRad(-90),0,Math.random()),i.scene.add(a),t.environmentBits.unshift(a)},t.addChallengeRow=(e,n=!1)=>{let r=n?-1400:-60*e,a=new o.Group;a.position.z=r;for(let e=0;e<5;e++){const t=10*Math.random();if(t<2){let t=l(e);a.add(t)}else if(t<4){let t=c(e);a.add(t)}else if(t>9){let t=d(e);a.add(t)}}t.challengeRows.unshift({rowParent:a,index:i.sceneConfiguration.challengeRowCount++}),i.scene.add(a)};const l=e=>{let n=t.crystalModel.clone();return n.position.x=11*e-20,n.scale.set(.02,.02,.02),n.userData.objectType=u.CRYSTAL,n},c=e=>{let n=t.rockModel.clone();return n.position.x=11*e-20,n.scale.set(5,5,5),n.position.setY(5),n.userData.objectType=u.ROCK,n},d=e=>{let n=t.shieldModel.clone();return n.position.x=11*e-20,n.position.y=8,n.userData.objectType=u.SHIELD_ITEM,n};var u;!function(e){e[e.ROCK=0]="ROCK",e[e.CRYSTAL=1]="CRYSTAL",e[e.SHIELD_ITEM=2]="SHIELD_ITEM"}(u=t.ObjectType||(t.ObjectType={}))},5249:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveCollectedBits=void 0;const o=n(5824),i=n(5968),r=n(8575);t.moveCollectedBits=()=>{for(let e=0;e<r.destructionBits.length;e++){let t=r.destructionBits[e];if(t.userData.lifetime>500)r.scene.remove(t),r.destructionBits.splice(e,1);else{let e=i.rocketModel.position,n=new o.Vector3(0,0,0);n.x=e.x-t.position.x,n.y=e.y-t.position.y,n.z=e.z-t.position.z,n.normalize(),t.translateOnAxis(n,.8),t.userData.lifetime++}}}},9264:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setProgress=t.showLevelEndScreen=t.updateLevelEndUI=t.nextLevel=t.uiInit=t.startPanel=t.startGameButton=t.startAgainButton=t.nextLevelButton=t.endLevelShipStatus=t.endLevelDescriptor=t.progressUiElement=t.shieldUiElement=t.crystalUiElement=void 0;const o=n(8575);t.crystalUiElement=document.getElementById("crystalCount"),t.shieldUiElement=document.getElementById("shieldCount"),t.progressUiElement=document.getElementById("courseProgress"),t.endLevelDescriptor=document.getElementById("levelDescriptor"),t.endLevelShipStatus=document.getElementById("shipStatus"),t.nextLevelButton=document.getElementById("nextLevel"),t.startAgainButton=document.getElementById("startOver"),t.startGameButton=document.getElementById("startGame"),t.startPanel=document.getElementById("levelStartPanel"),t.uiInit=()=>{t.startAgainButton.onclick=()=>{(0,t.nextLevel)(!0)}},t.nextLevel=(e=!1)=>{document.getElementById("endOfLevel").style.display="",document.getElementById("endOfLevel").classList.remove("fadeOut"),document.getElementById("endOfLevel").classList.add("hidden"),document.getElementById("startGame").classList.remove("hidden"),document.getElementById("levelStartPanel").classList.remove("hidden"),o.sceneConfiguration.cameraStartAnimationPlaying=!1,o.sceneConfiguration.rocketMoving=!1,o.sceneConfiguration.speed=.05,o.sceneConfiguration.speed=.1*o.sceneConfiguration.level,e?(0,o.sceneSetup)(1):(0,o.sceneSetup)(++o.sceneConfiguration.level)},t.updateLevelEndUI=e=>{if(t.endLevelDescriptor.innerText=`LEVEL ${o.sceneConfiguration.level}`,e)t.endLevelShipStatus.innerText="Your ship has hit too many rocks and is too damaged to continue!\r\n\r\nWe have another one you can use but you'll have to start over...",t.nextLevelButton.classList.add("hidden"),t.startAgainButton.classList.remove("hidden");else{let e=o.sceneConfiguration.data.shieldsCollected;5==e?t.endLevelShipStatus.innerText="Your ship is in pristine condition!":e>1&&e<5?t.endLevelShipStatus.innerText="Your ship is in pretty good condition.":0==e?t.endLevelShipStatus.innerText="Your ship is in the same condition as when you left.":e>=-4&&e<0&&(t.endLevelShipStatus.innerText="Your ship is in pretty bad shape. We'll patch it up, but try to hit less rocks."),t.nextLevelButton.classList.remove("hidden"),t.startAgainButton.classList.add("hidden")}},t.showLevelEndScreen=()=>{document.getElementById("endOfLevel").style.display="flex",document.getElementById("endOfLevel").classList.add("fadeOut"),document.getElementById("crystalCountLevelEnd").innerText=String(o.sceneConfiguration.data.crystalsCollected)},t.setProgress=e=>{let t=document.getElementById("loadingProgress");null!=t&&(t.innerText=e)}},5640:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTouchDevice=void 0,t.isTouchDevice=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0}},3993:(e,t,n)=>{n.r(t),n.d(t,{Water:()=>v});var o=n(660),i=n(2945),r=n(2630),a=n(1615),s=n(1723),l=n(538),c=n(2820),d=n(3212),u=n(4209),m=n(710),p=n(8310),g=n(1364),f=n(9749);class v extends o.e{constructor(e,t={}){super(e);const o=this,v=void 0!==t.textureWidth?t.textureWidth:512,h=void 0!==t.textureHeight?t.textureHeight:512,y=void 0!==t.clipBias?t.clipBias:0,w=void 0!==t.alpha?t.alpha:1,x=void 0!==t.time?t.time:0,C=void 0!==t.waterNormals?t.waterNormals:null,M=void 0!==t.sunDirection?t.sunDirection:new i.P(.70707,.70707,0),k=new r.Q(void 0!==t.sunColor?t.sunColor:16777215),L=new r.Q(void 0!==t.waterColor?t.waterColor:8355711),B=void 0!==t.eye?t.eye:new i.P(0,0,0),S=void 0!==t.distortionScale?t.distortionScale:20,P=void 0!==t.side?t.side:a.hB5,E=void 0!==t.fog&&t.fog,D=void 0!==t.speed?t.speed:5,b=new s.Z,T=new i.P,A=new i.P,O=new i.P,I=new l.k,z=new i.P(0,0,-1),_=new c.I,R=new i.P,j=new i.P,W=new c.I,U=new l.k,q=new d.u,F={minFilter:a.k6q,magFilter:a.k6q,format:a.HIg},N=new u.n(v,h,F);m.isPowerOfTwo(v)&&m.isPowerOfTwo(h)||(N.texture.generateMipmaps=!1);const V={uniforms:p.Ll.merge([g.f.fog,g.f.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new l.k},sunColor:{value:new r.Q(8355711)},sunDirection:{value:new i.P(.70707,.70707,0)},eye:{value:new i.P(0,0,0)},waterColor:{value:new r.Q(5592405)},speed:{value:5}}]),vertexShader:n(5726).A,fragmentShader:n(7888).A},G=new f.B({fragmentShader:V.fragmentShader,vertexShader:V.vertexShader,uniforms:p.Ll.clone(V.uniforms),lights:!0,side:P,fog:E});G.uniforms.mirrorSampler.value=N.texture,G.uniforms.textureMatrix.value=U,G.uniforms.alpha.value=w,G.uniforms.time.value=x,G.uniforms.normalSampler.value=C,G.uniforms.sunColor.value=k,G.uniforms.waterColor.value=L,G.uniforms.sunDirection.value=M,G.uniforms.distortionScale.value=S,G.uniforms.speed.value=D,G.uniforms.eye.value=B,o.material=G,o.onBeforeRender=function(e,t,n){if(A.setFromMatrixPosition(o.matrixWorld),O.setFromMatrixPosition(n.matrixWorld),I.extractRotation(o.matrixWorld),T.set(0,0,1),T.applyMatrix4(I),R.subVectors(A,O),R.dot(T)>0)return;R.reflect(T).negate(),R.add(A),I.extractRotation(n.matrixWorld),z.set(0,0,-1),z.applyMatrix4(I),z.add(O),j.subVectors(A,z),j.reflect(T).negate(),j.add(A),q.position.copy(R),q.up.set(0,1,0),q.up.applyMatrix4(I),q.up.reflect(T),q.lookAt(j),q.far=n.far,q.updateMatrixWorld(),q.projectionMatrix.copy(n.projectionMatrix),U.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),U.multiply(q.projectionMatrix),U.multiply(q.matrixWorldInverse),b.setFromNormalAndCoplanarPoint(T,A),b.applyMatrix4(q.matrixWorldInverse),_.set(b.normal.x,b.normal.y,b.normal.z,b.constant);const i=q.projectionMatrix;W.x=(Math.sign(_.x)+i.elements[8])/i.elements[0],W.y=(Math.sign(_.y)+i.elements[9])/i.elements[5],W.z=-1,W.w=(1+i.elements[10])/i.elements[14],_.multiplyScalar(2/_.dot(W)),i.elements[2]=_.x,i.elements[6]=_.y,i.elements[10]=_.z+1-y,i.elements[14]=_.w,B.setFromMatrixPosition(n.matrixWorld);const r=e.getRenderTarget(),a=e.xr.enabled,s=e.shadowMap.autoUpdate;o.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(N),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,q),o.visible=!0,e.xr.enabled=a,e.shadowMap.autoUpdate=s,e.setRenderTarget(r);const l=n.viewport;void 0!==l&&e.state.viewport(l)}}}v.prototype.isWater=!0}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,o),r.exports}o.m=t,e=[],o.O=(t,n,i,r)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,i,r]=e[d],s=!0,l=0;l<n.length;l++)(!1&r||a>=r)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(s=!1,r<a&&(a=r));if(s){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,i,r]},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var i,r,[a,s,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(i in s)o.o(s,i)&&(o.m[i]=s[i]);if(l)var d=l(o)}for(t&&t(n);c<a.length;c++)r=a[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=o.O(void 0,[154],(()=>o(8575)));i=o.O(i)})();